c*********************************************************************
c*
c*
c*		Расчет суммы невязок расстояний между фрагментом
c*			контура и сплайн-кривой
c*
c*
c* Параметры:   xy - координаты фрагмента контура
c*		n - число точек контура
c*		xk,yk,tk - координаты узлов параметрического сплайна
c*		c(ic,3,2) - сплайн-коэффициенты
c*		ds - суммарная невязка
c*		npnt - число точек контура, учавствовавших в расчете ds
c*		kindds - тип критерия невязки: 0 - сумма квадратов, 1 - 
c*			сумма модулей евклидовых расстояний
c*		eps - точность расчета расстояний (в 10km)
c*
c* Алгоритм: Если ближайшая точка  на сплайн-кривой от точки контура
c*		является первым или последним узлом, то такая точка 
c*		контура не учитывается в расчете ds
c*
c* Примечание. Минимальное расстояние считаем лишь для двух соседних
c*	звеньев сплайна, имеющих общий узел, ближайший к точке
c*	фрагмента контура.
c*
c*********************************************************************
	subroutine  dfcont(fi,lambda,xy,n,xk,yk,tk,nknot,c,ic,ds,npnt,
     *  kindds,eps)
	real xy(n,2),xk(nknot),yk(nknot),tk(nknot),c(ic,3,2)
	npnt=0
	ds=0
	do 10 i=1,n
	call  trdist(fi,lambda,xy(i,1),xy(i,2),xk,yk,tk,nknot,c,
     *  ic,xn,yn,tn,tga,vr,dist,eps,1)
c	print *,'tb,t,te,dist',tk(1),tn,tk(nknot),dist
	if(tn.eq.tk(1).or.tn.eq.tk(nknot)) go to 10
	npnt=npnt+1
	dist=abs(dist)
	if(kindds.eq.0) dist=dist*dist
	ds=ds+dist
10	continue
c	dsn=ds/npnt
	return
	end